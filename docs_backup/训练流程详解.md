# 训练流程详解

## 📖 一轮训练是什么?

一轮训练包含4个阶段:

```
【第 X 轮训练】
├─ 阶段1: 自我对弈 (100局)        ← 主要耗时部分
├─ 阶段2: 训练神经网络            ← 很快(几秒)
├─ 阶段3: 保存模型 (每10轮)       ← 很快(几秒)
└─ 阶段4: 评估棋力 (每5轮)        ← 10局,需要时间
```

---

## ⏱️ 时间估算

### 默认配置(MCTS=50, 每轮100局)

| 阶段 | 耗时 | 说明 |
|------|------|------|
| **阶段1: 自我对弈** | **2-3小时** | 100局,每局1-3分钟 |
| 阶段2: 训练网络 | 10-30秒 | 取决于缓冲区大小 |
| 阶段3: 保存模型 | 1-2秒 | 只在第10,20,30...轮 |
| 阶段4: 评估棋力 | 10-20分钟 | 只在第5,10,15...轮 |
| **总计** | **2-4小时/轮** | |

### 快速模式(MCTS=25, 每轮50局)

| 阶段 | 耗时 | 说明 |
|------|------|------|
| 阶段1: 自我对弈 | **30-60分钟** | 50局,每局0.5-1分钟 |
| 阶段2: 训练网络 | 10秒 | |
| 阶段4: 评估棋力 | 5-10分钟 | 10局 |
| **总计** | **40-70分钟/轮** | |

---

## 📊 输出示例

### 完整一轮的输出

```
============================================================
【第 1/100 轮训练】
时间: 2025-11-26 13:00:00

>> 阶段1: 自我对弈 (100局)...
   对弈 1/100... 和局 (200步)        ← 开始第1局
   对弈 2/100... 红胜 (87步)
   对弈 3/100... 黑胜 (95步)
   ...
   对弈 10/100... 和局 (150步)
   进度: 10/100 | 红:3 黑:2 和:5 | 平均步数: 134.5    ← 每10局汇总
   ...
   对弈 20/100... 红胜 (78步)
   进度: 20/100 | 红:8 黑:6 和:6 | 平均步数: 128.3
   ...
   对弈 100/100... 和局 (160步)      ← 完成第100局
   进度: 100/100 | 红:40 黑:35 和:25 | 平均步数: 125.8
   [完成] 100 局对弈                  ← 阶段1结束

>> 阶段2: 训练神经网络...           ← 阶段2开始
   平均损失: 0.3542                   ← 阶段2结束(很快)

>> 阶段4: 评估棋力...               ← 阶段4开始(第5轮才有)
   正在评估...
   测试结果 (10局):
   - 红方胜率: 45.0%
   - 平均步数: 130.5                  ← 阶段4结束

进度: 总对局数=100, 缓冲区=5000      ← 本轮总结
------------------------------------------------------------   ← 分隔线 = 本轮结束!

【第 2/100 轮训练】                  ← 开始下一轮
时间: 2025-11-26 16:00:00
...
```

---

## 🔍 如何判断一轮结束?

看到以下标志,表示一轮结束:

### 标志1: 分隔线
```
------------------------------------------------------------
```
这条线表示一轮完全结束!

### 标志2: 进度总结
```
进度: 总对局数=100, 缓冲区=5000
```
显示这行后,本轮就结束了。

### 标志3: 新一轮开始
```
【第 2/100 轮训练】
```
看到新的轮次,说明上一轮已经结束。

---

## 🎯 关键输出解读

### 自我对弈阶段

```
对弈 23/100... 红胜 (87步)
```

- `23/100` = 当前第23局,共100局
- `红胜` = 本局结果(红胜/黑胜/和局)
- `(87步)` = 本局走了87步

### 进度汇总(每10局)

```
进度: 30/100 | 红:12 黑:10 和:8 | 平均步数: 125.5
```

- `30/100` = 已完成30局
- `红:12` = 红方赢了12局
- `黑:10` = 黑方赢了10局
- `和:8` = 和局8局
- `平均步数: 125.5` = 平均每局125.5步

**判断进步**:
- 平均步数减少 → AI学会快速取胜
- 出现更多胜负 → AI不再只会和局

---

## ⏰ 实际案例

### 第1轮(初始随机网络)

```
【第 1/100 轮训练】
时间: 2025-11-26 10:00:00

>> 阶段1: 自我对弈 (100局)...
   对弈 1/100... 和局 (200步)     ← 10:02 开始
   对弈 2/100... 和局 (200步)     ← 10:05
   ...
   对弈 100/100... 和局 (200步)   ← 13:00 结束
   [完成] 100 局对弈

>> 阶段2: 训练神经网络...         ← 13:00
   平均损失: 0.8123                ← 13:01

进度: 总对局数=100, 缓冲区=5000
------------------------------------------------------------   ← 13:01 第1轮结束!
```

**耗时**: 约3小时

### 第5轮(有评估)

```
【第 5/100 轮训练】
时间: 2025-11-26 22:00:00

>> 阶段1: 自我对弈 (100局)...
   ...                             ← 22:00-01:00 (3小时)
   [完成] 100 局对弈

>> 阶段2: 训练神经网络...         ← 01:00
   平均损失: 0.4521

>> 阶段4: 评估棋力...             ← 01:00
   正在评估...                      ← 评估10局
   测试结果 (10局):
   - 红方胜率: 48.0%
   - 平均步数: 118.5               ← 01:15 评估结束

进度: 总对局数=500, 缓冲区=10000
------------------------------------------------------------   ← 01:15 第5轮结束!
```

**耗时**: 约3小时15分钟(含评估)

---

## 💡 训练建议

### 新手建议: 先快速验证

修改 `config.py`:
```python
MCTS_SIMULATIONS = 10    # 降低到10
SELF_PLAY_GAMES = 20     # 降低到20
```

这样:
- **一轮只需10-15分钟**!
- 可以快速看到完整流程
- 确认系统正常工作
- 然后再调回正常配置

### 实际训练计划

```python
# 第1天: 快速验证
MCTS_SIMULATIONS = 10
SELF_PLAY_GAMES = 20
# 训练5轮,约1小时,验证正常

# 第2天: 正式训练
MCTS_SIMULATIONS = 25
SELF_PLAY_GAMES = 50
# 训练10轮,约8-12小时

# 第3天以后: 高质量训练
MCTS_SIMULATIONS = 50
SELF_PLAY_GAMES = 100
# 长期训练,每轮3-4小时
```

---

## 🔄 中断和继续

### 中断(Ctrl+C)

会在以下时机安全退出:
- 当前局下完后
- 保存模型
- 显示"训练被用户中断"

### 继续训练

直接运行 `python main.py train`,会:
- 自动加载模型
- 显示"已训练 XXX 局"
- 从下一轮继续

---

## 📍 当前测试状态

您后台运行的测试:
```
python test_full_training.py
```

配置:
- 每轮3局(很快)
- 第1轮就评估
- **预计5-10分钟完成**

完成后会显示:
```
[成功] 完整训练流程测试通过!
  总对局数: 13 (3局训练 + 10局评估)
  [OK] 日志文件已生成: logs/training.log
```

---

**总结**:
- **一轮 = 100局对弈 + 训练网络 + (可能的)评估**
- **耗时 = 2-4小时/轮**
- **看到分隔线(`----`)就是一轮结束**

明白了吗? 😊
