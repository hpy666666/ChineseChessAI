# 中国象棋AI训练系统

**从零开始学习下象棋的AI，基于强化学习（AlphaZero简化版）**

观看AI一点点进步，从完全不会到能完成完整对局！

---

## 🎯 特点

- ✅ **完全自学习**: 不需要棋谱，AI通过自己和自己下棋学习
- ✅ **可视化训练**: 图形界面实时显示AI对局过程
- ✅ **自动保存**: 训练数据和模型自动保存，可随时继续
- ✅ **GPU加速**: 利用你的RTX 4070显卡，训练速度快20-50倍
- ✅ **详细注释**: 每个文件都有清晰的中文注释，易于理解

---

## 📁 项目结构

```
ChineseChessAI/
├── main.py              # 主程序（运行这个）
├── config.py            # 配置参数（可调整训练速度、难度等）
├── chess_env.py         # 象棋规则引擎（所有规则都在这里）
├── neural_network.py    # AI的大脑（神经网络）
├── self_play.py         # 自我对弈系统（MCTS + 神经网络）
├── trainer.py           # 训练管理器（数据收集、模型更新）
├── visualizer.py        # 图形界面（Pygame显示棋盘）
├── requirements.txt     # 依赖库列表
├── install.bat          # 一键安装脚本
├── README.md            # 本文件
├── data/                # 对局数据存储目录
├── models/              # AI模型存储目录
│   └── latest.pt        # 最新模型（自动生成）
└── logs/                # 训练日志目录
    └── training.log     # 训练记录（自动生成）
```

---

## 🚀 快速开始

### 第一步：安装依赖

**方法1：使用一键安装脚本（推荐）**

双击运行 `install.bat`，会自动安装所有依赖库。

**方法2：手动安装**

打开命令行，运行：

```bash
# 安装PyTorch (GPU版本)
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118

# 安装其他依赖
pip install numpy pygame
```

### 第二步：测试系统

```bash
python main.py test
```

这会测试所有模块是否正常工作，确保没有错误。

### 第三步：开始训练

```bash
python main.py train
```

你会看到类似这样的输出：

```
============================================================
开始训练中国象棋AI
============================================================
设备: cuda
GPU型号: NVIDIA GeForce RTX 4070 Laptop GPU
每轮自我对弈: 100局
MCTS模拟次数: 50
缓冲区大小: 10000
============================================================

【第 1/100 轮训练】
时间: 2025-11-25 14:30:00

▶ 阶段1: 自我对弈 (100局)...
   进度: 10/100 局 | 红胜:5 黑胜:4 和:1 | 平均步数: 45
   进度: 20/100 局 | 红胜:11 黑胜:8 和:1 | 平均步数: 42
   ...
```

**训练会一直运行**，你可以：
- 按 `Ctrl+C` 停止训练（模型会自动保存）
- 关闭窗口直接退出

### 第四步：观看AI对局

在另一个命令行窗口运行：

```bash
python main.py watch
```

会弹出图形界面，显示AI自我对弈的过程，你可以看到：
- 棋盘和棋子
- 当前走棋方
- AI的思考过程
- 最终胜负结果

---

## 📊 AI学习进度

| 训练局数 | 预期表现 | 预计时间 (RTX 4070) |
|---------|---------|-------------------|
| 100局 | 学会基本走法规则 | 10-20分钟 |
| 500局 | 知道吃子，不会乱送子 | 1-2小时 |
| 2000局 | 有简单战术意识 | 4-6小时 |
| 5000局 | 业余初级水平 | 1-2天 |
| 10000局 | 能完成完整对局 | 2-3天 |

**注意**: 实际时间取决于：
- `MCTS_SIMULATIONS`参数（在config.py中）
- 电脑性能
- 是否使用GPU

---

## ⚙️ 配置调整

打开 `config.py` 可以调整参数：

### 训练速度 vs 棋力

```python
# 快速训练（棋力较弱）
MCTS_SIMULATIONS = 25        # 每步思考25次
SELF_PLAY_GAMES = 50         # 每轮50局

# 平衡模式（推荐）
MCTS_SIMULATIONS = 50        # 每步思考50次
SELF_PLAY_GAMES = 100        # 每轮100局

# 高质量（训练慢，棋力强）
MCTS_SIMULATIONS = 200       # 每步思考200次
SELF_PLAY_GAMES = 200        # 每轮200局
```

### 神经网络大小

```python
# 在 neural_network.py 中调整
class ChessNet(nn.Module):
    def __init__(self, num_channels=128):  # 减小到64会更快，增大到256会更强
```

---

## 💾 数据存储说明

### 存储内容

1. **对局数据** (`data/`)
   - 每局的棋盘状态、走法、结果
   - 用于训练神经网络
   - 自动管理，旧数据会被覆盖

2. **模型文件** (`models/`)
   - `latest.pt`: 最新的AI模型（50-500MB）
   - `model_1000.pt`: 训练1000局时的备份
   - 每1000局自动备份一次

3. **训练日志** (`logs/training.log`)
   - 记录每次评估的结果
   - 可以查看AI的进步曲线

### 预计占用空间

- 初期: 2-5GB
- 训练10000局后: 10-20GB
- **建议**: 定期清理 `data/` 目录中的旧数据

---

## 🎮 使用指南

### 命令列表

```bash
python main.py train     # 开始/继续训练
python main.py watch     # 观看AI对局（图形界面）
python main.py test      # 测试各模块
python main.py help      # 显示帮助信息
```

### 常见使用场景

**场景1: 首次训练**
```bash
python main.py train
# 等待一段时间...
# 按 Ctrl+C 停止
```

**场景2: 继续训练**
```bash
python main.py train
# 会自动加载 models/latest.pt 继续训练
```

**场景3: 观看进步**
```bash
# 训练一段时间后
python main.py watch
# 会显示AI当前的水平
```

---

## 🔧 技术原理（给小白的解释）

### AI是怎么学习的？

1. **自我对弈**: AI左手和右手下棋
   - 刚开始完全随机走
   - 下完一局记录所有走法

2. **判断好坏**:
   - 赢了的走法 → 标记为"好"
   - 输了的走法 → 标记为"不好"

3. **学习调整**:
   - 神经网络学习这些标记
   - 调整参数让"好"走法出现概率变高

4. **循环提升**:
   - 用新的AI继续下棋
   - 重复上面的过程

### MCTS（蒙特卡洛树搜索）是什么？

简单理解：
- 每次走棋前，AI会"想象"很多种可能
- 比如MCTS_SIMULATIONS=50，就是想象50次
- 选择最好的那个走法

### 为什么需要GPU？

- 神经网络计算量很大
- GPU可以并行计算，速度快几十倍
- 你的RTX 4070能大幅加速训练

---

## 📈 进阶使用

### 与AI对弈（需要自己实现）

可以添加人类玩家模块，让你和AI下棋：

1. 在 `visualizer.py` 中添加鼠标点击事件
2. 检测点击位置，转换为走法
3. 让AI响应你的走法

### 调整训练策略

在 `trainer.py` 中可以修改：
- 学习率衰减
- 探索温度调度
- 训练批次大小

### 保存对局棋谱

在 `self_play.py` 中添加：
```python
# 保存为PGN格式或XQF格式
def save_game_to_file(game_data, filename):
    # 实现棋谱保存
    pass
```

---

## 🐛 常见问题

### Q: 提示"CUDA不可用"怎么办？
A:
1. 检查是否安装了GPU版本的PyTorch
2. 运行 `install.bat` 会自动安装正确版本
3. 如果仍然不行，检查NVIDIA驱动是否最新

### Q: 训练很慢怎么办？
A:
1. 减小 `MCTS_SIMULATIONS` 参数
2. 减小 `SELF_PLAY_GAMES` 参数
3. 确保使用了GPU（检查输出中的"使用设备: cuda"）

### Q: 内存不够怎么办？
A:
1. 减小 `BUFFER_SIZE` 参数
2. 减小 `BATCH_SIZE` 参数
3. 清理 `data/` 目录中的旧数据

### Q: AI下棋很傻怎么办？
A:
- 这是正常的！需要训练更久
- 建议至少训练2000局再评估
- 增加 `MCTS_SIMULATIONS` 提升思考深度

### Q: 如何备份训练成果？
A:
复制整个 `models/` 目录即可，里面有所有模型

---

## 📚 代码说明

### 文件功能详解

| 文件 | 功能 | 代码量 | 难度 |
|-----|------|--------|------|
| `chess_env.py` | 实现象棋规则（走法、吃子、胜负） | ~300行 | ⭐⭐ |
| `neural_network.py` | AI大脑（卷积神经网络） | ~200行 | ⭐⭐⭐ |
| `self_play.py` | MCTS搜索 + 自我对弈 | ~250行 | ⭐⭐⭐⭐ |
| `trainer.py` | 训练循环（数据收集、模型更新） | ~200行 | ⭐⭐⭐ |
| `visualizer.py` | 图形界面（Pygame） | ~200行 | ⭐⭐ |
| `main.py` | 主程序（命令行接口） | ~150行 | ⭐ |
| `config.py` | 配置参数 | ~50行 | ⭐ |

### 关键算法

1. **MCTS** (`self_play.py`):
   - `MCTSNode`: 搜索树节点
   - `select_child()`: UCB选择
   - `expand()`: 节点扩展
   - `update()`: 反向传播

2. **神经网络** (`neural_network.py`):
   - 输入: 15通道棋盘编码
   - 输出: 策略头 + 价值头
   - 结构: Conv + ResBlock + FC

3. **训练循环** (`trainer.py`):
   - 自我对弈 → 数据收集
   - 随机采样 → 训练网络
   - 定期评估 → 保存模型

---

## 🎓 学习路径

### 初学者
1. 先运行 `python main.py test` 熟悉系统
2. 阅读 `chess_env.py` 理解象棋规则
3. 运行 `python main.py train` 开始训练
4. 观看 `python main.py watch` 看AI表现

### 进阶学习
1. 阅读 `self_play.py` 理解MCTS算法
2. 阅读 `neural_network.py` 理解网络结构
3. 修改 `config.py` 参数观察影响
4. 尝试改进算法（更深的网络、更好的编码）

### 高级扩展
1. 实现完整的策略损失函数
2. 添加人机对弈功能
3. 实现开局库
4. 添加TensorBoard可视化
5. 尝试完整版AlphaZero

---

## 📝 参数参考

### 训练参数对照表

| 参数 | 影响 | 推荐值 | 范围 |
|-----|------|--------|------|
| `MCTS_SIMULATIONS` | 思考深度 | 50 | 10-500 |
| `SELF_PLAY_GAMES` | 每轮对局数 | 100 | 10-500 |
| `BATCH_SIZE` | 训练批次 | 64 | 16-256 |
| `LEARNING_RATE` | 学习速度 | 0.001 | 0.0001-0.01 |
| `BUFFER_SIZE` | 经验容量 | 10000 | 1000-50000 |

---

## 🙏 致谢

本项目基于以下算法和技术：
- AlphaZero (DeepMind, 2017)
- 蒙特卡洛树搜索 (MCTS)
- PyTorch 深度学习框架
- Pygame 游戏开发库

---

## 📞 支持

如有问题或建议，可以：
1. 查看本README的"常见问题"部分
2. 运行 `python main.py help` 查看命令说明
3. 检查 `logs/training.log` 查看训练日志

---

## 📜 许可

本项目仅供学习和研究使用。

---

**祝训练愉快！看着AI一点点进步是很有成就感的 🎉**
